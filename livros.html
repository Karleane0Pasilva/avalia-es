<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catálogo de Livros</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonte e estilo global -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Supabase -->
  <script type="module" src="js/supabase.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- NAVBAR -->
  <header class="bg-white shadow sticky top-0 z-10">
    <div class="max-w-6xl mx-auto flex justify-between items-center px-6 py-4">
      <a href="index.html" class="font-semibold text-gray-800">PROJETO AVALIAÇÕES</a>
      <nav class="space-x-6 text-gray-700 font-medium">
        <a href="livros.html" class="text-blue-600 font-semibold">LIVROS</a>
        <a href="perfil.html" class="hover:text-blue-600">AVALIAÇÕES</a>
        <a href="solicitacao.html" class="hover:text-blue-600">SOLICITAÇÕES</a>
        <a href="login.html" class="text-red-600 font-semibold hover:text-red-700">SAIR</a>
      </nav>
    </div>
  </header>

  <!-- CONTEÚDO -->
  <main class="flex-grow px-6 py-10">
    <div class="max-w-6xl mx-auto text-center">
      <h1 class="text-2xl font-bold mb-8">Catálogo de Livros</h1>

      <!-- Grid dos livros -->
      <div id="livrosContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8">
        <!-- Livros carregados aqui -->
      </div>

      <!-- Mensagem de status -->
      <p id="mensagemStatus" class="text-gray-500 mt-8"></p>
    </div>
  </main>

  <!-- RODAPÉ -->
  <footer class="text-center text-sm text-gray-500 py-6 border-t mt-10">
    © 2025 - Projeto Avaliações. Desenvolvido para fins acadêmicos.
  </footer>

  <!-- CONTAINER DO MODAL -->
  <div id="modalContainer"></div>

  <!-- TOAST -->
  <div id="toast"
    class="fixed bottom-6 right-6 bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-300">
  </div>

  <!-- SCRIPT -->
   <script type="module">
  import { supabase } from './js/supabase.js'

    const container = document.getElementById('livrosContainer')
    const msg = document.getElementById('mensagemStatus')


    // TOAST
    function toast(m) {
      const t = document.getElementById('toast')
      t.textContent = m
      t.classList.remove('opacity-0')
      setTimeout(() => t.classList.add('opacity-0'), 1800)
    }

    // CARREGAR LIVROS
    async function carregarLivros() {
      msg.textContent = 'Carregando livros...'

      const { data: livros, error } = await supabase
        .from('livros')
        .select('id, titulo, capa')
        .order('id', { ascending: true })

      if (error) {
        console.error('Erro ao carregar livros:', error)
        msg.textContent = '❌ Erro ao carregar livros.'
        return
      }

      msg.textContent = ''
      container.innerHTML = ''

      livros.forEach(livro => {
        const card = document.createElement('div')
        card.className =
          'bg-white rounded-lg shadow hover:shadow-lg transition cursor-pointer text-center p-3 flex flex-col items-center'

        card.innerHTML = `
          <img src="${livro.capa}" alt="${livro.titulo}" class="h-60 w-auto object-contain mb-3 rounded">
          <h3 class="font-semibold text-sm text-gray-800">${livro.titulo}</h3>
        `

        //CLIQUE QUE ABRE MODAL
        card.addEventListener('click', () => abrirInfoLivro(livro.id))

        container.appendChild(card)
      })
    }

    carregarLivros()

  // ABRIR MODAL
  window.abrirInfoLivro = async function(id) {
    const resposta = await fetch('./popups/infolivros.html')
    const container = document.getElementById('modalContainer')
    container.innerHTML = await resposta.text()

    const modal = document.getElementById('modalInfoLivro')
    modal.classList.remove('hidden')

    const { data, error } = await supabase
      .from('livros')
      .select('*')
      .eq('id', id)
      .single()

    if (!error && data) {
      document.getElementById('infoTitulo').textContent = data.titulo
      document.getElementById('infoAutor').textContent = data.autor
      document.getElementById('infoEditora').textContent = data.editora || '-'
      document.getElementById('infoLancamento').textContent = data.lancamento || '-'
      document.getElementById('infoDescricao').textContent = data.resumo || 'Sem descrição.'

      const capa = document.getElementById('infoCapa')
      const ph = document.getElementById('infoCapaPlaceholder')

      if (data.capa) {
        capa.src = data.capa
        capa.classList.remove('hidden')
        ph.classList.add('hidden')
      }
    }

    // FECHAR
    document.getElementById('fecharInfoLivro').onclick =
    document.getElementById('btnFecharInfoLivro').onclick = () => {
      modal.classList.add('hidden')
    }

    // AVALIAR
    document.getElementById('btnAvaliarLivro').onclick = () => {
      window.location.href = 'perfil.html'
    }
  }
  </script>

</body>
</html>
